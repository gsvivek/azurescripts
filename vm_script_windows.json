{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json# ",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "vmName": {
			"type": "string"
		},
		"adminUsername": {
			"type": "string"
		},
		"adminPassword": {
			"type": "string"
		},
		"vmSize": {
			"type": "string"
		},
		"nicName": {
			"type": "string"
		},
		"vhdStorageAccountName": {
			"type": "string"
		}               
    },
    "variables": {"apiVersion" : "2015-05-01"},
    "resources": [
    {
		"apiVersion": "[variables('apiVersion')]",
		"type": "Microsoft.Compute/virtualMachines",
		"name": "[parameters('vmName')]",
		"location": "[resourceGroup().location]",
		"properties": {
			"hardwareProfile" : {
				"vmSize" : "[parameters('vmSize')]"
			},
			"osProfile" : {
				"computerName" : "[parameters('vmName')]",
				"adminUsername" : "[parameters('adminUsername')]",
				"adminPassword" : "[parameters('adminPassword')]"
			},
			"storageProfile" : {
				"osDisk": {
					"name": "[concat(parameters('vmName'),'-osDisk')]",
					"osType": "windows",
					"caching": "ReadWrite",
					"createOption": "FromImage",
					"image": {
					  "uri": "https://infacloudazure2351.blob.core.windows.net/system/Microsoft.Compute/Images/ics-payg/win2012r2-osDisk.fa619ee2-cb71-428e-9e9c-26163b3a6ab3.vhd"
					},
					"vhd": {
					  "uri": "[concat(reference(concat('Microsoft.Storage/storageAccounts/', parameters('vhdStorageAccountName')), variables('apiVersion')).primaryEndpoints.blob, 'vhds/',parameters('vmName'), uniquestring(resourceGroup().id), 'osDisk.vhd')]"
					}
				}
			},
			"networkProfile" : {
				"networkInterfaces" : [{
						"id" : "[resourceId('Microsoft.Network/networkInterfaces',parameters('nicName'))]"
					}
				]
			}
		},
		"resources": [{
			"publisher" : "Microsoft.Compute",
			"type" : "CustomScriptExtension",
			"typeHandlerVersion" : "1.8",
			"autoUpgradeMinorVersion" : true,
			"settings" : {
				"fileUris" : ["https://github.com/gsvivek/azurescripts/raw/master/InfaCloudExtProvision.ps1"],
				"commandToExecute" : "[concat('powershell.exe -ExecutionPolicy Unrestricted -File InfaCloudExtProvision.ps1 ', parameters('cloudEmail'),' ',parameters('cloudPassword'),' ',parameters('connectorUUIDList'))]"
			}
		}
		]
    }
    ]
}